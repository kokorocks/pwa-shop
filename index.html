<!--link rel="manifest" href="/manifest.json">
 <script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/service-worker.js')
  .then(() => console.log('Service Worker Registered'))
    .catch((err) => console.log('Service Worker Registration Failed', err));
    }
   </script-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic PWA</title>
    <meta name="theme-color" content="#007bff">
    <link rel="icon" href="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABbklEQVR42p2SQUvDQBSGv3MLyU9xlYqJ8QQhKylpBQkRJUKCCPoCXWgr2CMm1tbWUVCHqKPrwn0khaSkhKSmoQSMo3DMN7L3d6bOH0Qck3i+u7nPu2ON2FYajcGMW0Gl1GEAVRVEVABFAEpVS5H9fJ6QSCIjSYLA0AXJZFJKn1hO6zoOT3MycE6kQid6JYMIQqAYCwO57nKUSyaTSXTxIliHDvNx+NsmE8C4kkCQ9XudECOcRy+cJpZKkMmA6AeR+vUCmJgDHJxDpMg2n/f6PRGAZukArJ2CEOmSCOHq9UKqSCuCAJ+sox/A4Xvw5AERWhnmaH4gTS1q4TS8B9FGNCv+3Z4ccnJISjIwFOUAAnRR1zztR7pSyLKFv+AgbVoGMEvmoGPE/EqWtIwvX48ALm92KpCFwcqtYiO6PgnmAeuq4ag+FQBfFn2N1xV8ADauHiFS2EOB2AAAAAElFTkSuQmCC">
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 50px;
            background: #f4f4f4;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background: #007bff;
            color: #fff;
            border: none;
            border-radius: 5px;
            margin-top: 10px;
        }
    </style>
</head>
<body>

    <h1>Dynamic PWA</h1>
    <p>This app can be installed and works offline!</p>
    <button id="installPWA" style="display:none;">Install PWA</button>

    <script>
        // 1️⃣ Dynamic Manifest
        const manifestData = {
            name: "Dynamic PWA",
            short_name: "PWA",
            start_url: ".",
            display: "standalone",
            background_color: "#ffffff",
            theme_color: "#007bff",
            icons: [
                {
                    src: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABbklEQVR42p2SQUvDQBSGv3MLyU9xlYqJ8QQhKylpBQkRJUKCCPoCXWgr2CMm1tbWUVCHqKPrwn0khaSkhKSmoQSMo3DMN7L3d6bOH0Qck3i+u7nPu2ON2FYajcGMW0Gl1GEAVRVEVABFAEpVS5H9fJ6QSCIjSYLA0AXJZFJKn1hO6zoOT3MycE6kQid6JYMIQqAYCwO57nKUSyaTSXTxIliHDvNx+NsmE8C4kkCQ9XudECOcRy+cJpZKkMmA6AeR+vUCmJgDHJxDpMg2n/f6PRGAZukArJ2CEOmSCOHq9UKqSCuCAJ+sox/A4Xvw5AERWhnmaH4gTS1q4TS8B9FGNCv+3Z4ccnJISjIwFOUAAnRR1zztR7pSyLKFv+AgbVoGMEvmoGPE/EqWtIwvX48ALm92KpCFwcqtYiO6PgnmAeuq4ag+FQBfFn2N1xV8ADauHiFS2EOB2AAAAAElFTkSuQmCC",
                    sizes: "192x192",
                    type: "image/png"
                }
            ]
        };

        const manifestBlob = new Blob([JSON.stringify(manifestData)], { type: "application/json" });
        const manifestURL = URL.createObjectURL(manifestBlob);
        const link = document.createElement("link");
        link.rel = "manifest";
        link.href = manifestURL;
        document.head.appendChild(link);

        // 2️⃣ Dynamic Service Worker
        const swCode = `
            self.addEventListener('install', (event) => {
                event.waitUntil(
                    caches.open('pwa-cache').then((cache) => {
                        return cache.addAll([
                            '/',
                            '/index.html'
                        ]);
                    })
                );
            });

            self.addEventListener('fetch', (event) => {
                event.respondWith(
                    caches.match(event.request).then((response) => {
                        return response || fetch(event.request);
                    })
                );
            });
        `;

        const swBlob = new Blob([swCode], { type: "application/javascript" });
        const swURL = URL.createObjectURL(swBlob);

        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register(swURL)
                .then(() => console.log('Service Worker Registered'))
                .catch((error) => console.error('Service Worker Registration Failed:', error));
        }

        // 3️⃣ PWA Install Button
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (event) => {
            event.preventDefault();
            deferredPrompt = event;
            document.getElementById('installPWA').style.display = 'block';
        });

        document.getElementById('installPWA').addEventListener('click', () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('PWA Installed');
                    }
                    deferredPrompt = null;
                });
            }
        });

    </script>

</body>
</html>
